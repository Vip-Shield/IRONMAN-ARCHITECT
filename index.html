<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#e10600">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <title>Ironman Architect - Champion</title>
<link rel="shortcut icon" type="imagex/png" href="./img/logo-iron-man.ico">

    <style>
        :root {
            --iron-red: #e10600;
            --iron-dark: #0f0f0f;
            --iron-panel: rgba(26, 26, 26, 0.9); 
            --iron-white: #ffffff;
            --iron-gray: #444;
            --iron-gold: #ffce00;
            --iron-green: #00ff88;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background-color: var(--iron-dark);
            color: var(--iron-white);
            margin: 0; 
            padding: 20px;
            min-height: 100vh;
        }

        .bg-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            /* Certifique-se que a imagem existe na pasta img ou altere o caminho */
            background-image: url('./img/iron_man.jpg');
            background-size: cover; background-position: center;
            filter: blur(8px) brightness(0.4); transform: scale(1.1);
        }

        .container { max-width: 900px; margin: 0 auto; position: relative; z-index: 1; }

        /* HEADER & FASE */
        header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid var(--iron-gray); padding-bottom: 20px; margin-bottom: 20px;
            flex-wrap: wrap; gap: 15px;
        }
        
        .brand h1 { margin: 0; font-style: italic; letter-spacing: -1px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        
        .header-controls { display: flex; gap: 10px; align-items: center; }

        .phase-badge {
            background: var(--iron-red); padding: 5px 15px; border-radius: 4px;
            font-weight: bold; font-size: 0.9rem; text-transform: uppercase;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .btn-plan {
            background: rgba(255,255,255,0.1); border: 1px solid var(--iron-white);
            color: var(--iron-white); padding: 5px 15px; border-radius: 4px;
            cursor: pointer; font-size: 0.8rem; text-transform: uppercase;
            transition: 0.3s; backdrop-filter: blur(5px);
        }
        .btn-plan:hover { background: var(--iron-white); color: var(--iron-black); }

        /* NOVO: BOT√ÉO DE ENGRENAGEM */
        .btn-gear {
            background: transparent; border: none; color: var(--iron-white);
            cursor: pointer; padding: 5px; display: flex; align-items: center;
            transition: transform 0.3s;
        }
        .btn-gear:hover { transform: rotate(90deg); color: var(--iron-gold); }
        .btn-gear svg { width: 24px; height: 24px; fill: currentColor; }

        /* INPUTS */
        .input-section {
            background: var(--iron-panel); padding: 20px; border-radius: 8px;
            margin-bottom: 30px; border: 1px solid #333;
            backdrop-filter: blur(10px); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .input-group { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; }
        input {
            background: rgba(37, 37, 37, 0.8); border: 1px solid var(--iron-gray);
            color: white; padding: 12px; border-radius: 4px; flex: 1; min-width: 120px;
        }
        .btn-main {
            background: var(--iron-red); color: white; border: none;
            padding: 12px 25px; border-radius: 4px; cursor: pointer;
            font-weight: bold; text-transform: uppercase; width: 100%;
            transition: 0.2s; box-shadow: 0 4px 15px rgba(225, 6, 0, 0.4);
        }
        .btn-main:hover { background: #b30500; }

        /* DASHBOARD GRID */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .card {
            background: var(--iron-panel); padding: 20px;
            border-radius: 8px; border: 1px solid #333;
            position: relative; overflow: hidden;
            backdrop-filter: blur(10px); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .card h3 { margin: 0; font-size: 0.8rem; color: #888; text-transform: uppercase; }
        .value-display { font-size: 2.2rem; font-weight: bold; margin: 10px 0; }
        .sub-value { font-size: 0.9rem; color: #666; }
        
        .progress-bg { background: #333; height: 6px; border-radius: 3px; margin-top: 15px; }
        .progress-fill { background: var(--iron-red); height: 100%; width: 0%; transition: 1s; }

        /* MODAL GERAL */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 100;
            display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: var(--iron-panel); padding: 30px; border-radius: 8px;
            border: 1px solid var(--iron-gray); max-width: 600px; width: 90%;
            box-shadow: 0 0 30px rgba(0,0,0, 0.8); position: relative;
        }
        .close-btn {
            position: absolute; top: 15px; right: 20px;
            color: #888; cursor: pointer; font-size: 1.5rem;
        }

        /* ESTILO DO PLANO T√ÅTICO */
        .plan-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .plan-item {
            background: rgba(37, 37, 37, 0.8); padding: 15px; border-radius: 5px; border-left: 3px solid var(--iron-red);
        }
        .plan-item h4 { margin: 0 0 5px 0; color: var(--iron-red); text-transform: uppercase; font-size: 0.85rem; }
        .plan-item p { margin: 0; font-size: 0.9rem; color: #ddd; line-height: 1.4; }
        .full-width { grid-column: 1 / -1; border-left: 3px solid var(--iron-gold); }

        /* FOOTER ACTIONS */
        .footer-actions {
            margin-top: 50px; text-align: center; border-top: 1px solid #333; padding-top: 20px;
            background: rgba(0,0,0,0.5); padding: 20px; border-radius: 8px;
        }
        .btn-report {
            background: transparent; border: 1px solid var(--iron-gold); color: var(--iron-gold);
            padding: 10px 20px; cursor: pointer; font-weight: bold; text-transform: uppercase;
             backdrop-filter: blur(5px);
        }

        /* TABLE RELATORIO */
        .report-table { width: 100%; margin: 20px 0; border-collapse: collapse; }
        .report-table th, .report-table td { padding: 10px; border-bottom: 1px solid #444; text-align: left; }
        .verdict { font-size: 1.2rem; font-weight: bold; text-align: center; margin: 20px 0; }
        .verdict.aprovado { color: var(--iron-green); }

        /* NOVO: BOT√ïES DO MODAL DE CONFIGURA√á√ÉO */
        .settings-buttons { display: flex; gap: 15px; margin-top: 25px; flex-wrap: wrap; }
        .btn-save-manual { background-color: var(--iron-green); color: var(--iron-dark); }
        .btn-save-manual:hover { background-color: #00cc6a; }
        .btn-load-manual { background-color: var(--iron-gold); color: var(--iron-dark); }
        .btn-load-manual:hover { background-color: #e6b800; }

    </style>
</head>
<body>

<div class="bg-overlay"></div>

<div class="container">
    <header>
        <div class="brand">
            <h1>IRONMAN <span style="color: var(--iron-red);">ARCHITECT</span></h1>
        </div>
        <div class="header-controls">
            <button class="btn-plan" onclick="openPlan()">üìã Ver Plano T√°tico</button>
            
            <button class="btn-gear" onclick="openSettings()" aria-label="Configura√ß√µes">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.43-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
            </button>

            <div class="phase-badge" id="phase-badge">Fase 1</div>
        </div>
    </header>

    <div class="input-section">
        <h3 style="margin-top:0; color: #ccc;">Registro Di√°rio</h3>
        <div class="input-group">
            <input type="number" id="in-swim" placeholder="Nata√ß√£o (m)">
            <input type="number" id="in-bike" placeholder="Bike (km)">
            <input type="number" id="in-run" placeholder="Corrida (km)">
        </div>
        <button class="btn-main" onclick="addTraining()">Registrar Treino & Atualizar</button>
    </div>

    <div class="grid">
        <div class="card">
            <h3>Nata√ß√£o (Acumulado)</h3>
            <div class="value-display"><span id="val-swim">0</span> <small>m</small></div>
            <div class="sub-value">Meta Fase: <span id="goal-swim">0</span>m</div>
            <div class="progress-bg"><div id="bar-swim" class="progress-fill"></div></div>
        </div>
        <div class="card">
            <h3>Bike (Acumulado)</h3>
            <div class="value-display"><span id="val-bike">0</span> <small>km</small></div>
            <div class="sub-value">Meta Fase: <span id="goal-bike">0</span>km</div>
            <div class="progress-bg"><div id="bar-bike" class="progress-fill"></div></div>
        </div>
        <div class="card">
            <h3>Corrida (Acumulado)</h3>
            <div class="value-display"><span id="val-run">0</span> <small>km</small></div>
            <div class="sub-value">Meta Fase: <span id="goal-run">0</span>km</div>
            <div class="progress-bg"><div id="bar-run" class="progress-fill"></div></div>
        </div>
    </div>

    <div class="footer-actions">
        <button class="btn-report" onclick="generateReport()">‚ö† Encerrar Fase & Avaliar</button>
    </div>
</div>

<div class="modal-overlay" id="planModal">
    <div class="modal-content">
        <span class="close-btn" onclick="closePlan()">&times;</span>
        <h2 style="margin-top:0; color: var(--iron-white);">Briefing da Miss√£o</h2>
        <p style="color: var(--iron-red); font-weight: bold; text-transform: uppercase;" id="plan-phase-name"></p>
        <p style="font-style: italic; color: #888; margin-bottom: 20px;" id="plan-objective"></p>
        
        <div class="plan-grid" id="plan-container"></div>
    </div>
</div>

<div class="modal-overlay" id="reportModal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeReport()">&times;</span>
        <h2 style="margin-top:0; color: var(--iron-red);">Relat√≥rio de Cruzamento</h2>
        <table class="report-table">
            <thead><tr><th>Disciplina</th><th>Realizado</th><th>Meta</th><th>%</th></tr></thead>
            <tbody id="report-body"></tbody>
        </table>
        <div id="verdict-display" class="verdict"></div>
        <p id="verdict-msg" style="text-align: center; font-size: 0.9rem; color: #ccc;"></p>
        <button class="btn-main" onclick="advancePhase()" id="btn-advance" style="display:none; margin-top:15px;">Avan√ßar Fase</button>
    </div>
</div>

<div class="modal-overlay" id="settingsModal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeSettings()">&times;</span>
        <h2 style="margin-top:0; color: var(--iron-white);">Controle de Dados</h2>
        <p style="color: #ccc;">O aplicativo salva automaticamente, mas voc√™ pode for√ßar a√ß√µes manuais aqui.</p>
        
        <div class="settings-buttons">
            <button class="btn-main btn-save-manual" onclick="manualSave()">
                üíæ Salvar Dados Agora
            </button>
            <button class="btn-main btn-load-manual" onclick="manualLoad()">
                üîÑ Recarregar √öltimo Salve
            </button>
        </div>
        <p style="font-size: 0.8rem; color: #888; margin-top: 20px;">*√ötil se voc√™ trocou de dispositivo recentemente ou se os dados parecerem desatualizados.</p>
    </div>
</div>


<script>
    // --- CONFIGURA√á√ÉO DETALHADA DAS FASES ---
    const phasesConfig = [
        {
            id: 1,
            name: "Fase 1: Constru√ß√£o da Base (M√™s 1-3)",
            goals: { swim: 24000, bike: 600, run: 120 },
            plan: {
                obj: "Sair do zero sem les√µes. Foco em t√©cnica e adapta√ß√£o.",
                swim: "2x semana | Foco t√©cnico (respira√ß√£o e economia).",
                bike: "1-2x semana (40-60min) | Leve (Ergom√©trica ou Rua).",
                run: "2-3x semana (30min) | Caminhada progredindo para Trote Leve.",
                gym: "2x semana | Obrigat√≥rio: Perna, Core e Costas."
            }
        },
        {
            id: 2,
            name: "Fase 2: Resist√™ncia Real (M√™s 4-6)",
            goals: { swim: 36000, bike: 1200, run: 300 },
            plan: {
                obj: "Aumentar volume e resist√™ncia aer√≥bica.",
                swim: "1.500m - 2.000m por sess√£o | Foco em volume.",
                bike: "60-90min | Introduzir ritmo de cruzeiro.",
                run: "5-8km confort√°veis | 5x na semana (treino geral).",
                gym: "Manuten√ß√£o 2x semana | 1 Treino combinado leve (Bike + Corrida)."
            }
        },
        {
            id: 3,
            name: "Fase 3: Volume Espec√≠fico (M√™s 7-9)",
            goals: { swim: 45000, bike: 2000, run: 450 },
            plan: {
                obj: "Simula√ß√£o de prova e queima de gordura.",
                swim: "2.500m - 3.000m | S√©ries longas.",
                bike: "Long√£o: 2h30 a 4h | Alimenta√ß√£o na bike.",
                run: "Long√£o: 12-18km | Ritmo de prova.",
                gym: "1 Treino BRICK semanal (Bike + Corrida na sequ√™ncia)."
            }
        },
        {
            id: 4,
            name: "Fase 4: Polimento (M√™s 10-12)",
            goals: { swim: 15000, bike: 400, run: 80 },
            plan: {
                obj: "Simula√ß√£o final e Taper (descanso estrat√©gico).",
                swim: "3.000m - 3.800m | Simula√ß√£o completa.",
                bike: "Simula√ß√£o de 5h | Teste final de equipamento.",
                run: "Simula√ß√£o 25-30km | Foco mental.",
                gym: "Redu√ß√£o dr√°stica de volume nas √∫ltimas 3 semanas."
            }
        }
    ];

    let appState = JSON.parse(localStorage.getItem('ironmanState')) || {
        phaseIndex: 0,
        data: { swim: 0, bike: 0, run: 0 }
    };

    function init() { updateUI(); }

    function addTraining() {
        const s = parseFloat(document.getElementById('in-swim').value) || 0;
        const b = parseFloat(document.getElementById('in-bike').value) || 0;
        const r = parseFloat(document.getElementById('in-run').value) || 0;

        appState.data.swim += s;
        appState.data.bike += b;
        appState.data.run += r;

        saveState();
        updateUI();
        
        document.getElementById('in-swim').value = '';
        document.getElementById('in-bike').value = '';
        document.getElementById('in-run').value = '';
    }

    // Fun√ß√£o principal de salvar (autom√°tica)
    function saveState() {
        try {
            localStorage.setItem('ironmanState', JSON.stringify(appState));
        } catch (e) {
            alert("Erro cr√≠tico: N√£o foi poss√≠vel salvar no armazenamento local. O dispositivo pode estar sem mem√≥ria.");
            console.error("Erro ao salvar:", e);
        }
    }

    function updateUI() {
        const currentPhase = phasesConfig[appState.phaseIndex];
        
        document.getElementById('phase-badge').innerText = currentPhase.name.split(':')[0];
        
        document.getElementById('val-swim').innerText = appState.data.swim;
        document.getElementById('val-bike').innerText = appState.data.bike;
        document.getElementById('val-run').innerText = appState.data.run;

        document.getElementById('goal-swim').innerText = currentPhase.goals.swim;
        document.getElementById('goal-bike').innerText = currentPhase.goals.bike;
        document.getElementById('goal-run').innerText = currentPhase.goals.run;

        updateBar('swim', appState.data.swim, currentPhase.goals.swim);
        updateBar('bike', appState.data.bike, currentPhase.goals.bike);
        updateBar('run', appState.data.run, currentPhase.goals.run);
    }

    function updateBar(type, val, goal) {
        const pct = Math.min((val / goal) * 100, 100);
        const bar = document.getElementById(`bar-${type}`);
        bar.style.width = pct + '%';
        bar.style.background = pct >= 100 ? 'var(--iron-green)' : 'var(--iron-red)';
    }

    // --- L√ìGICA DOS MODAIS (Plano, Relat√≥rio e Configura√ß√µes) ---
    function openPlan() {
        const phase = phasesConfig[appState.phaseIndex];
        document.getElementById('plan-phase-name').innerText = phase.name;
        document.getElementById('plan-objective').innerText = "Objetivo: " + phase.plan.obj;
        
        const container = document.getElementById('plan-container');
        container.innerHTML = `
            <div class="plan-item"><h4>üèä Nata√ß√£o</h4><p>${phase.plan.swim}</p></div>
            <div class="plan-item"><h4>üö¥ Ciclismo</h4><p>${phase.plan.bike}</p></div>
            <div class="plan-item"><h4>üèÉ Corrida</h4><p>${phase.plan.run}</p></div>
            <div class="plan-item full-width"><h4>üèãÔ∏è Muscula√ß√£o / Extra</h4><p>${phase.plan.gym}</p></div>
        `;
        
        document.getElementById('planModal').style.display = 'flex';
    }

    function closePlan() { document.getElementById('planModal').style.display = 'none'; }

    // NOVO: Fun√ß√µes do Modal de Configura√ß√µes (Engrenagem)
    function openSettings() { document.getElementById('settingsModal').style.display = 'flex'; }
    function closeSettings() { document.getElementById('settingsModal').style.display = 'none'; }

    // NOVO: Fun√ß√µes Manuais de Salvar/Carregar
    function manualSave() {
        saveState(); // Usa a mesma l√≥gica do salvamento autom√°tico
        alert("‚úÖ Dados salvos manualmente com sucesso!");
        closeSettings();
    }

    function manualLoad() {
        if(confirm("Tem certeza? Isso recarregar√° o √∫ltimo estado salvo, descartando qualquer dado n√£o salvo na tela atual.")) {
            const savedData = localStorage.getItem('ironmanState');
            if (savedData) {
                appState = JSON.parse(savedData);
                updateUI(); // Atualiza a tela com os dados recarregados
                alert("üîÑ Dados recarregados com sucesso!");
            } else {
                alert("‚ùå Nenhum dado salvo encontrado para recarregar.");
            }
            closeSettings();
        }
    }

    // --- L√ìGICA DO RELAT√ìRIO ---
    function generateReport() {
        const currentPhase = phasesConfig[appState.phaseIndex];
        const data = appState.data;
        const goals = currentPhase.goals;

        const pSwim = (data.swim / goals.swim) * 100;
        const pBike = (data.bike / goals.bike) * 100;
        const pRun = (data.run / goals.run) * 100;
        const avgCompletion = (pSwim + pBike + pRun) / 3;

        const tbody = document.getElementById('report-body');
        tbody.innerHTML = `
            <tr><td>Nata√ß√£o</td><td>${data.swim}m</td><td>${goals.swim}m</td><td style="color:${getColor(pSwim)}">${pSwim.toFixed(1)}%</td></tr>
            <tr><td>Bike</td><td>${data.bike}km</td><td>${goals.bike}km</td><td style="color:${getColor(pBike)}">${pBike.toFixed(1)}%</td></tr>
            <tr><td>Corrida</td><td>${data.run}km</td><td>${goals.run}km</td><td style="color:${getColor(pRun)}">${pRun.toFixed(1)}%</td></tr>
        `;

        const verdictTitle = document.getElementById('verdict-display');
        const verdictMsg = document.getElementById('verdict-msg');
        const btnAdvance = document.getElementById('btn-advance');

        if (avgCompletion >= 80) {
            verdictTitle.innerText = "APROVADO PARA AVAN√áAR";
            verdictTitle.className = "verdict aprovado";
            verdictMsg.innerText = "Volume consistente. Pronto para o pr√≥ximo n√≠vel.";
            btnAdvance.style.display = 'block';
        } else {
            verdictTitle.innerText = "D√âFICIT DE VOLUME";
            verdictTitle.className = "verdict";
            verdictTitle.style.color = "var(--iron-red)";
            verdictMsg.innerText = "Complete mais treinos antes de avan√ßar.";
            btnAdvance.style.display = 'none';
        }

        document.getElementById('reportModal').style.display = 'flex';
    }

    function closeReport() { document.getElementById('reportModal').style.display = 'none'; }
    
    function getColor(pct) { return pct >= 100 ? 'var(--iron-green)' : (pct >= 70 ? 'var(--iron-gold)' : 'var(--iron-red)'); }

    function advancePhase() {
        if (appState.phaseIndex < phasesConfig.length - 1) {
            appState.phaseIndex++;
            appState.data = { swim: 0, bike: 0, run: 0 };
            saveState();
            init();
            closeReport();
            alert("Bem-vindo √† " + phasesConfig[appState.phaseIndex].name);
        } else {
            alert("Parab√©ns! Ciclo Ironman Completo!");
        }
    }

    init();

    // --- REGISTRO DO SERVICE WORKER (PWA) ---
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('Service Worker registrado!', reg))
                .catch(err => console.log('Erro ao registrar SW:', err));
        });
    }
</script>

</body>
</html>